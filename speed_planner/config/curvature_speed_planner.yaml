speed_planner:
  ros__parameters:
    # ========== 토픽들 ==========
    path_topic: "/local_planned_path"                        # 입력 경로 (nav_msgs/Path, frame_id=base_link, 등간격 샘플)
    current_speed_topic: "/current_speed"                    # 현재 속도 (std_msgs/Float32, m/s)
                                                             # 제어에서 제공해주는 모터로 구한 속도 : /ctrl/speed [m/s]
                                                             # GPS-IMU Fusion 속도 : /current_speed/odom [m/s]
                                                            
    desired_speed_profile_topic: "/desired_speed_profile"    # 출력 속도 프로파일 (Float32MultiArray)
    v_cmd_topic: "/cmd/speed"                                # 최종 단일 목표속도 (Float32)

    # ========== v_cmd 발행 옵션 ==========
    publish_v_cmd: true               # v_cmd도 함께 발행할지
    publish_rate_hz: 20.0             # v_cmd 발행 주기 [Hz] (제어 주기와 맞추면 좋음)

    # ========== v_cmd 인덱스 선택 모드 ==========
    # "distance": cmd_offset_m [m] 앞 지점 사용(단순/안정, 곡률 반응 둔감 가능)
    # "index":    fixed_index_offset 인덱스 사용(고정 샘플수, ds 일정일 때 distance와 유사)
    # "time":     현재속도 v * preview_time 만큼 앞 지점 사용(속도 의존 프리뷰)
    # "adaptive": 곡률 적응형 프리뷰 (커브 급할수록 짧게, 직선일수록 멀리)
    cmd_index_mode: "adaptive"   # "distance" / "index" / "time" / "adaptive"

    # ---- distance 모드용 ----
    cmd_offset_m: 1.5                  # [m] 권장 1.0~2.5 (직선에서 가속 잘 붙게 하려면 ↑)

    # ---- index 모드용 ----
    fixed_index_offset: 3              # [샘플] ds=0.5이면 3 → 1.5 m와 동일

    # ---- time 모드용 ----
    preview_time: 0.60                 # [s] 권장 0.3~0.8 (빠르면 ↑, 민감하면 ↓)

    # ---- adaptive 모드용 ----
    preview_time_min: 0.25             # [s] 최소 프리뷰 시간 (급커브 시 최소값으로 수렴)
    preview_time_max: 0.70             # [s] 최대 프리뷰 시간 (직선 시 최대값으로 수렴)
    kappa_beta: 5.0                    # 곡률 민감도(↑면 곡률에 더 민감)
    kappa_window: 7                    # 현재 기준 |kappa| 평균에 쓸 샘플 개수(0=미사용, 3~7 권장)

    # ========== 프리뷰 구간 보수성/연속성 ==========
    use_window_min: true              # true면 [i0..i0+N] 구간 최솟값 사용(보수적 제동 여유)
    look_ahead_count: 3                # 최솟값 창 크기(0~3 권장). 직선은 0~1, 불확실 땐 2~3
    seed_from_current_speed: true      # 첫 발행 시 /current_speed로 가속클램프 시드(초기 0 묶임 방지)
    clamp_accel: true                  # v_cmd에 종방향 가/감속 클램프 적용
    a_long_max: 4.0                    # [m/s^2] 가속 한계 (직선 가속 ↑: 3.0~5.0 권장)
    a_long_min: -3.0                   # [m/s^2] 감속 한계(음수) (제동 여유 확보 시 |값| ↑)

    # ========== 경로 샘플 간격/속도/횡가속 한계 ==========
    ds: 0.2                            # [m] 샘플 간격 (reference_path_planning.py 의 arc_step와 동일해야 함!)
    v_min: 0.20                        # [m/s] 너무 낮게 두면 정지 근처 진동↑
    v_max: 2.3                         # [m/s] 직선 목표 최고속 (백파일 최고속도 이상으로 설정)
    a_lat_max: 2.0                     # [m/s^2] 횡가속 한계 (낮추면 커브서 감속↑ / 보수적)

    # ========== 수치 안정화/스무딩 ==========
    eps_kappa: 1.0e-6                  # 곡률 0 분모 보호
    smooth_window: 5                   # 이동평균 창(홀수). 1이면 스무딩 없음 (3~5 권장)

    # ========== 디버그 ==========
    publish_debug_markers: false       # true면 /speed_planner/debug로 곡률/속도 라인 표시

    # ==== 빠른 튜닝 가이드 ====
    # 직선 가속이 답답 → v_max↑, a_long_max↑, (use_window_min=false or look_ahead_count↓)
    # 커브에서 불안 → a_lat_max↓, look_ahead_count↑, kappa_beta↑(adaptive), preview_time_min↓
    # 곡률 반영 둔감 → cmd_index_mode="adaptive", kappa_window↑, kappa_beta↑

    # ==== RPM 관련 파라미터 ====
    # ----- RPM 발행 -----
    publish_rpm_cmd: true         # /cmd/rpm도 함께 발행
    rpm_topic: "/cmd/rpm"         # Float32 (원하면 Int32로 바꿔도 OK)

    # 변환 상수: RPM_motor = v[m/s] * 60 * gear_ratio / (pi * wheel_diameter_m)
    wheel_diameter_m: 0.47        # 바퀴 지름 [m] (예: 47cm)
    gear_ratio: 4.6               # 모터:바퀴 기어비 (wheelRPM = motorRPM/4.6)

    # 한계/라운딩 (선택)
    rpm_min: 0.0                  # 필요 시 컨트롤러 허용 범위로 클램프
    rpm_max: 4675.0
    rpm_round_to_int: false       # true면 반올림(Int 동작 느낌)