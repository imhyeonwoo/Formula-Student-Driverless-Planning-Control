pure_pursuit_adaptive:
  ros__parameters:
    # I/O
    path_topic: "/local_planned_path"
    speed_topic: "/ctrl/speed"
    # GPS-IMU Fusion으로 구한 속도 : /current_speed/odom
    # 하드웨어 제어에서 발행하는 모터 속도 : /ctrl/speed
    steer_topic: "/cmd/steer"
    debug_marker_topic: "/pure_pursuit/debug_markers"
    base_frame: "base_link"   # 내부 계산은 모두 base_link 기준. Path가 다른 frame이면 TF로 변환.

    # Vehicle
    wheelbase_m: 1.3

    # LAD scheduling
    use_speed_term: true
    L0: 3.8
    k_v: 0.20
    use_curvature_term: true
    k_curv: 0.05
    epsilon_kappa: 0.02
    Ld_min: 4.2
    Ld_max: 5.5

    # Target selection
    use_arc_length_selection: true
    x_forward_only: true      # (참고) 이제 s-기반 선택이라 영향은 적지만 유지
    forward_margin_x: -0.1

    # Outer-offset (pd -> pl)
    outer_offset_enable: true
    alpha_max_m: 3.0
    beta_max: 3.0
    curv_window_m: 2.0
    outer_offset_max_m: 0.6   # 바깥 이동 최대값. 줄이면 pl이 바깥으로 밀리는 상한이 줄어듦.
    outer_offset_tau_max: 0.7 # 값을 낮추면: 코너에서 pl이 바깥으로 덜 밀림(보수적). 값을 높이면: 바깥 오프셋이 더 자주/크게 발생(공격적).
    outer_offset_kappa_gate: 0.03
    track_half_width_m: 2.5   # 트랙 폭의 절반
    track_margin_m: 0.3       # 차량이 트랙 경계에 너무 가까이 가지 않도록 마진

    # Command shaping
    publish_rate_hz: 50.0
    steer_limit_deg: 30.0
    steer_rate_limit_deg_per_s: 360.0
    ema_tau_cmd: 0.12
    ema_tau_speed: 0.8

    # Noise suppression (new)
    sticky_window_pts: 15
    kappa_smooth_window_pts: 7
    target_ema_tau: 0.08

    # RViz2 debug
    show_lookahead_circle: true
    show_points: true
    show_tangent: true
    show_offset_vec: true
    show_selected_path: false
    show_steer_arrow: true
    show_steer_text: false
    marker_alpha: 1.0
    circle_points: 60

    # Colors
    color_pw_r: 0.10
    color_pw_g: 0.60
    color_pw_b: 1.00

    color_pd_r: 0.10
    color_pd_g: 1.00
    color_pd_b: 0.10

    color_pl_r: 1.00
    color_pl_g: 0.10
    color_pl_b: 0.80

    color_tan_r: 1.00
    color_tan_g: 0.00
    color_tan_b: 0.10

    color_vec_r: 0.00
    color_vec_g: 0.90
    color_vec_b: 1.00

    color_cir_r: 1.00
    color_cir_g: 1.00
    color_cir_b: 1.00

## Note: Speed/RPM commands are handled by local_speed_planner.
## No constant_cmd_publisher section is needed in pure_pursuit configs.
