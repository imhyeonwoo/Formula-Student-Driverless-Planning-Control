pure_pursuit_predictive:
  ros__parameters:
    # I/O
    path_topic: "/local_planned_path"
    speed_topic: "/current_speed"
    # steer_topic: "/cmd/steer_predictive"   # ê¸°ì¡´ê³¼ ë¶„ë¦¬
    steer_topic: "/cmd/steer"
    debug_marker_topic: "/pure_pursuit/predictive_debug"
    base_frame: "base_link"

    # Vehicle
    wheelbase_m: 1.3

    # Prediction (ì˜ˆì¸¡ ê¸°ë°˜ s0)
    predict_enable: true
    T_pred_sec: 0.12          # íŒŒì´í”„ë¼ì¸ ì§€ì—° í•©ê³¼ ë¹„ìŠ·í•˜ê²Œ ì‹œì‘ (0.1~0.25)
    use_cmd_curvature: true   # yaw_rate í† í”½ ì—†ì„ ë•Œ, ì§ì „ ì¡°í–¥ ëª…ë ¹ìœ¼ë¡œ yaw rate ê·¼ì‚¬

    # Look-ahead (ì‹œê°„ê¸°ë°˜ Ld + ê³¡ë¥ í•­ í˜¼í•©)
    use_time_term: true       # v*T_LA + L_bias
    T_LA: 0.42
    L_bias: 0.70
    use_speed_term: false     # L0 + k_v*v (ì›í•˜ë©´ ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ true)
    L0: 2.5
    k_v: 0.6
    use_curvature_term: true
    k_curv: 0.25               # |kappa| ì‘ì„ìˆ˜ë¡ Ldâ†‘
    epsilon_kappa: 1.0e-6
    Ld_min: 2.2
    Ld_max: 4.8

    # s-íˆìŠ¤í…Œë¦¬ì‹œìŠ¤ & ìŠ¤í‹°í‚¤(ë¯¸í„° ë‹¨ìœ„)
    s_back_hys_m: 0.8
    allow_backtrack_heading_deg: 135.0  # ê²½ë¡œ ì ‘ì„ ê³¼ ì°¨ëŸ‰ í—¤ë”©(=xì¶•) ì°¨ì´ê°€ í´ ë•Œë§Œ s í›„í‡´ í—ˆìš©
    sticky_window_m: 0.9                 # ì´ì „ s_pd ì£¼ë³€ Â±m ìœˆë„

    # Outer-offset (pd -> pl, ì½”ë„ˆ ì»¤íŒ… ì–µì œ)
    outer_offset_enable: true
    alpha_max_m: 3.0
    beta_max: 3.0
    curv_window_m: 2.0
    outer_offset_max_m: 1.0
    outer_offset_tau_max: 0.7
    outer_offset_kappa_gate: 0.03
    track_half_width_m: 2.5
    track_margin_m: 0.2

    # Command shaping
    publish_rate_hz: 50.0
    steer_limit_deg: 30.0
    steer_rate_limit_deg_per_s: 360.0
    ema_tau_cmd: 0.08
    ema_tau_speed: 0.20
    target_ema_tau: 0.05
    kappa_smooth_window_pts: 3

    # RViz2 debug
    show_lookahead_circle: true
    show_points: true
    show_tangent: true
    show_offset_vec: true
    show_selected_path: false
    show_steer_arrow: true
    show_steer_text: false
    marker_alpha: 1.0
    circle_points: 60

    # Colors
    color_pw_r: 0.10
    color_pw_g: 0.60
    color_pw_b: 1.00

    color_pd_r: 0.10
    color_pd_g: 1.00
    color_pd_b: 0.10

    color_pl_r: 1.00
    color_pl_g: 0.10
    color_pl_b: 0.80

    color_tan_r: 1.00
    color_tan_g: 0.85
    color_tan_b: 0.10

    color_vec_r: 0.00
    color_vec_g: 0.90
    color_vec_b: 1.00

    color_cir_r: 1.00
    color_cir_g: 1.00
    color_cir_b: 1.00

#------------------------------------------------------------#
# ğŸ“Œ Predictive Pure Pursuit íŠœë‹ ê°€ì´ë“œ (ë¶™ì—¬ë„£ê¸°ìš© ë©”ëª¨)
#    - "ë„ˆë¬´ ë©€ë¦¬ ë³¸ë‹¤"ë©´ â¬‡ï¸ í‘œì‹œí•œ í•­ëª©ë¶€í„° ìˆœì„œëŒ€ë¡œ ì¤„ì—¬ë³´ì„¸ìš”.
#
# [í•µì‹¬ ìš”ì•½ â€“ ê°€ê¹Œì´ ë³´ì´ê²Œ ë§Œë“œëŠ” ë¹ ë¥¸ ë ˆì‹œí”¼]
#  1) T_LA            â¬‡ï¸  (ì˜ˆ: 0.60 â†’ 0.45)
#  2) L_bias          â¬‡ï¸  (ì˜ˆ: 0.9  â†’ 0.7)
#  3) Ld_max          â¬‡ï¸  (ì˜ˆ: 7.0  â†’ 5.5)
#  4) k_curv          â¬‡ï¸  (ì˜ˆ: 0.6  â†’ 0.3)  # ì§ì„ ì—ì„œ Ldê°€ ê³¼í•˜ê²Œ ëŠ˜ì–´ë‚˜ëŠ” ëŠë‚Œ ì–µì œ
#  5) T_pred_sec      â¬‡ï¸  (ì˜ˆ: 0.18 â†’ 0.12) # ì˜ˆì¸¡ ê¸°ì¤€ì ì„ ëœ ì•ìª½ìœ¼ë¡œ
#  6) ema_tau_cmd     â¬‡ï¸  (ì˜ˆ: 0.12 â†’ 0.08) # ë°˜ì‘ ëŠë¦¼ â†’ ë©€ë¦¬ ë³¸ë‹¤ëŠ” ì²´ê° ì™„í™”
#  7) target_ema_tau  â¬‡ï¸  (ì˜ˆ: 0.08 â†’ 0.05) # íƒ€ê¹ƒ ì  ê´€ì„± ì¤„ì´ê¸°
#
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# | íŒŒë¼ë¯¸í„°                 | ê¸°ë³¸ê°’ | ì—­í• /ì˜í–¥                                  | ê°€ê¹Œì´(â¬‡ï¸) ë³¼ ë•Œ               | ë©€ë¦¬(â¬†ï¸) ë³¼ ë•Œ                | ë¹„ê³ 
# |--------------------------|--------|--------------------------------------------|--------------------------------|-------------------------------|------------------------------
# | use_time_term            | true   | Ld = v*T_LA + L_bias ì‚¬ìš© ì—¬ë¶€              | (ë³´í†µ ìœ ì§€)                     | (ë³´í†µ ìœ ì§€)                   | time/speed ì¤‘ 1ê°€ì§€ë§Œ true ê¶Œì¥
# | T_LA                     | 0.60   | ì†ë„ ë¹„ë¡€ ì‹œì„ ê±°ë¦¬(ì´ˆ)                     | â¬‡ï¸ (0.45~0.5)                   | â¬†ï¸ (0.7~0.9)                  | vê°€ í´ìˆ˜ë¡ íš¨ê³¼ í¼
# | L_bias                   | 0.9    | ì •ì§€/ì €ì†ì—ì„œì˜ ê¸°ë³¸ ê±°ë¦¬                   | â¬‡ï¸ (0.6~0.8)                    | â¬†ï¸ (1.0~1.4)                  | ì €ì† ì²´ê°ì— ì˜í–¥ í¼
# | use_speed_term           | false  | Ld = L0 + k_v*v ì‚¬ìš© ì—¬ë¶€                   | (ë³´í†µ false)                    | (ë³´í†µ false)                  | time-term ëŒ€ì²´ì•ˆ. ë‘˜ ë‹¤ trueë©´ í•©ì‚°ë¨
# | L0                       | 2.5    | ì†ë„í•­ ëª¨ë¸ì˜ ê¸°ì¤€                          | â¬‡ï¸                              | â¬†ï¸                            | use_speed_term=trueì¼ ë•Œë§Œ ìœ íš¨
# | k_v                      | 0.6    | ì†ë„ê³„ìˆ˜                                    | â¬‡ï¸                              | â¬†ï¸                            | â†‘v êµ¬ê°„ì—ì„œ Ld ê¸°ìš¸ê¸°
# | use_curvature_term       | true   | ê³¡ë¥  ê¸°ë°˜ ë³´ì • í•­ ì‚¬ìš©                      | (ìœ ì§€)                          | (ìœ ì§€)                        | ì§ì„ =ì¦ê°€, ì»¤ë¸Œ=ìƒëŒ€ ê°ì†Œ
# | k_curv                   | 0.6    | ê³¡ë¥ í•­ í¬ê¸°                                 | â¬‡ï¸ (0~0.4)                      | â¬†ï¸ (0.8~1.2)                  | ë„ˆë¬´ í¬ë©´ ì§ì„ ì—ì„œ ê³¼ì¥
# | epsilon_kappa            | 1e-6   | ê³¡ë¥ í•­ ë¶„ëª¨ ì•ˆì •í™”                          | (ê±°ì˜ ë³€ê²½ X)                   | (ê±°ì˜ ë³€ê²½ X)                 | ìˆ˜ì¹˜ ì•ˆì •ìš©
# | Ld_min                   | 1.0    | Ld í•˜í•œ                                     | â¬†ï¸(ë„ˆë¬´ ê°€ê¹ê²Œ ë¶™ìœ¼ë©´)           | â¬‡ï¸(ì €ì†ì—ì„œ ë„ˆë¬´ ë©€ë©´ ë°©ì§€ í•´ì œ)| í•˜í•œ í´ìˆ˜ë¡ ìµœì†Œ ì‹œì„ ê±°ë¦¬â†‘
# | Ld_max                   | 7.0    | Ld ìƒí•œ                                     | â¬‡ï¸ (5.0~6.0)                    | â¬†ï¸ (8.0~10.0)                 | ê³ ì† ìƒí•œ ìº¡
# | predict_enable           | true   | ì˜ˆì¸¡ ê¸°ì¤€ì  ì‚¬ìš©                            | (ìœ ì§€)                          | (ìœ ì§€)                        | T_pred_secë¡œ ê°•ë„ ì¡°ì ˆ
# | T_pred_sec               | 0.18   | ì˜ˆì¸¡ì‹œê°„(ì§€ì—° ë³´ìƒ)                         | â¬‡ï¸ (0.10~0.15)                  | â¬†ï¸ (0.20~0.25)                | ë„ˆë¬´ í¬ë©´ ì „ë°˜ì ìœ¼ë¡œ ì•ì„ ë³´ê²Œ ë¨
# | use_cmd_curvature        | true   | ì§ì „ ì¡°í–¥ìœ¼ë¡œ yaw-rate ê·¼ì‚¬                  | falseë¡œ í…ŒìŠ¤íŠ¸                  | true ìœ ì§€                     | IMU yaw-rate ì—†ì„ ë•Œ ìœ ìš©
# | s_back_hys_m             | 0.8    | s í›„í‡´ íˆìŠ¤í…Œë¦¬ì‹œìŠ¤                         | â¬†ï¸ (0.9~1.2)                    | â¬‡ï¸ (0.5~0.7)                  | í›„í‡´ ì–µì œâ†‘ â†’ ì í”„/ì˜¤ë²„ìŠˆíŠ¸ ì™„í™”
# | allow_backtrack_headingâ€¦ | 135.0  | í›„í‡´ í—ˆìš© í—¤ë”© ì°¨ ì„ê³„(ë„)                  | â¬‡ï¸ (120~130)                    | â¬†ï¸ (150~180)                  | ì‘ê²Œ=í›„í‡´ ì˜ ì•ˆí•¨(ë³´ìˆ˜ì )
# | sticky_window_m          | 1.2    | s-ìŠ¤í‹°í‚¤ ìœˆë„(Â±m)                           | â¬‡ï¸ (0.6~1.0)                    | â¬†ï¸ (1.5~2.0)                  | ì‘ê²Œ=ë¹ ë¥¸ ì¶”ì¢…, í¬ê²Œ=ì•ˆì •
# | outer_offset_enable      | true   | pdâ†’pl ë°”ê¹¥ ì˜¤í”„ì…‹                           | ìƒí™© ë”°ë¼                       | ìƒí™© ë”°ë¼                     | ì»¤íŒ… ì–µì œ(ê±°ë¦¬ì—” ì§ì ‘ ì˜í–¥ X)
# | outer_offset_max_m       | 1.0    | ìµœëŒ€ ë°”ê¹¥ ì˜¤í”„ì…‹                             | â¬‡ï¸ (0.6~0.8)                    | â¬†ï¸ (1.2~1.5)                  | íƒ€ê¹ƒ íš¡ì´ë™ í•œê³„
# | outer_offset_tau_max     | 0.7    | ì˜¤í”„ì…‹ ê°€ì¤‘ ìƒí•œ                             | â¬‡ï¸                              | â¬†ï¸                            | ì½”ë„ˆì—ì„œ ê³¼ë„ ì´ë™ ì–µì œ/ê°•í™”
# | outer_offset_kappa_gate  | 0.03   | ê±°ì˜ ì§ì„ : ì˜¤í”„ì…‹ ì°¨ë‹¨ ì„ê³„                  | â¬†ï¸ (0.04~0.06)                  | â¬‡ï¸ (0.02~0.025)               | ì§ì„ ì—ì„œ ë°”ê¹¥ ì´ë™ êº¼ë²„ë¦¼
# | track_half_width_m       | 2.5    | íŠ¸ë™ ë°˜í­                                    | (íŠ¸ë™ í­ì— ë§ì¶¤)                | (íŠ¸ë™ í­ì— ë§ì¶¤)              | ì•ˆì „ ì˜¤í”„ì…‹ ìƒí•œ ê²°ì •ì— ì‚¬ìš©
# | track_margin_m           | 0.2    | íŠ¸ë™ ê²½ê³„ ë§ˆì§„                               | â¬†ï¸                              | â¬‡ï¸                            | ê²½ê³„ ê·¼ì ‘ ì–µì œ
# | publish_rate_hz          | 50.0   | ì œì–´ ì£¼ê¸°                                    | â¬†ï¸ (ì‘ë‹µâ†‘)                      | â¬‡ï¸ (ë¶€í•˜â†“)                    | ì„¼ì„œ/CPU ì—¬ìœ  ê³ ë ¤
# | steer_rate_limit_deg_per_s| 360.0 | ì¡°í–¥ ëª…ë ¹ ë³€í™”ìœ¨ ì œí•œ                         | â¬†ï¸ (480~600)                    | â¬‡ï¸ (240~300)                  | ëŠë¦¬ë©´ ë©€ë¦¬ ë³¸ë‹¤ ì²´ê° â†‘
# | ema_tau_cmd              | 0.12   | ì¡°í–¥ ëª…ë ¹ EMA ì‹œì •ìˆ˜                         | â¬‡ï¸ (0.06~0.10)                  | â¬†ï¸ (0.15~0.25)                | ë¶€ë“œëŸ¬ì›€ vs ë°˜ì‘ì„±
# | ema_tau_speed            | 0.20   | ì†ë„ EMA ì‹œì •ìˆ˜                              | â¬‡ï¸                              | â¬†ï¸                            | Ld ë³€ë™ì„±ì— ê°„ì ‘ ì˜í–¥
# | target_ema_tau           | 0.08   | pl(íƒ€ê¹ƒ) EMA ì‹œì •ìˆ˜                           | â¬‡ï¸ (0.04~0.06)                  | â¬†ï¸ (0.10~0.15)                | íƒ€ê¹ƒ ì  ê´€ì„±
# | kappa_smooth_window_pts  | 3      | ê³¡ë¥  ìŠ¤ë¬´ë”© ë°˜í­(í¬ì¸íŠ¸)                      | â¬‡ï¸ (2)                           | â¬†ï¸ (4~5)                      | ë„ˆë¬´ í¬ë©´ ì§€ì—°â†‘, ë„ˆë¬´ ì‘ìœ¼ë©´ ë…¸ì´ì¦ˆâ†‘
# | RViz show_*              | true   | ë””ë²„ê·¸ ì‹œê°í™”                                | í•„ìš”ì‹œ On/Off                   | í•„ìš”ì‹œ On/Off                 | ì„±ëŠ¥ì—” ì˜í–¥ ì—†ìŒ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
# [íŠœë‹ íŒ]
# - time ëª¨ë¸(use_time_term)ê³¼ speed ëª¨ë¸(use_speed_term)ì€ "ë‘˜ ì¤‘ í•˜ë‚˜"ë§Œ ì“°ëŠ” ê±¸ ê¶Œì¥.
# - ê³ ì† ì§ì„ ì—ì„œë§Œ ê³¼í•˜ê²Œ ë©€ë¦¬ ë³´ì´ë©´: k_curv â¬‡ï¸, Ld_max â¬‡ï¸.
# - ì»¤ë¸Œì—ì„œë§Œ ë©€ë¦¬ ë³´ì´ë©´: T_LA â¬‡ï¸ ë˜ëŠ” L_bias â¬‡ï¸(ì €ì† ì»¤ë¸Œ íš¨ê³¼), outer_offset_kappa_gate â¬†ï¸ ë¡œ ì»¤íŒ…ì–µì œë§Œ ë‚¨ê¸°ê¸°.
# - ë°˜ì‘ì´ ëŠë ¤ì„œ ë©€ì–´ ë³´ì´ë©´: ema_tau_cmd â¬‡ï¸, steer_rate_limit_deg_per_s â¬†ï¸, target_ema_tau â¬‡ï¸.
# - ì˜ˆì¸¡ì´ ê³¼í•˜ë©´: T_pred_sec â¬‡ï¸, use_cmd_curvature=false í…ŒìŠ¤íŠ¸.
# - s ì í”„ê°€ ì‹ ê²½ ì“°ì´ë©´: sticky_window_m â¬†ï¸(ì•ˆì •), s_back_hys_m â¬†ï¸(í›„í‡´ ì–µì œ).
# - ê³¼ë„í•˜ê²Œ ê°€ê¹Œì›Œì ¸ ë–¨ë¦¬ë©´: Ld_min â¬†ï¸, target_ema_tau â¬†ï¸, kappa_smooth_window_pts â¬†ï¸.
#------------------------------------------------------------#
